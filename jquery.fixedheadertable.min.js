"use strict";
/*global $, jQuery*/
/*!
 * jquery.fixedHeaderTable. The jQuery fixedHeaderTable plugin
 *
 * Copyright (c) 2011 Mark Malek
 * http://fixedheadertable.com
 *
 * Licensed under MIT
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * http://docs.jquery.com/Plugins/Authoring
 * jQuery authoring guidelines
 *
 * Launch  : October 2009
 * Version : 1.3
 * Released: May 9th, 2011
 *
 * 
 * all CSS sizing (width,height) is done in pixels (px)
 */
(function($){var types=["DOMMouseScroll","mousewheel"];$.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var i=types.length;i;)this.addEventListener(types[--i],handler,false);else this.onmousewheel=handler},teardown:function(){if(this.removeEventListener)for(var i=types.length;i;)this.removeEventListener(types[--i],handler,false);else this.onmousewheel=null}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",
fn)}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(event.wheelDelta)delta=event.wheelDelta/120;if(event.detail)delta=-event.detail/3;deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta}var userAgent=navigator.userAgent.toLowerCase();var wheelDeltaScaleFactor=1;if(jQuery.browser.msie||jQuery.browser.webkit&&
!/chrome/.test(userAgent))wheelDeltaScaleFactor=40;if(orgEvent.wheelDeltaY!==undefined)deltaY=orgEvent.wheelDeltaY/120/wheelDeltaScaleFactor;if(orgEvent.wheelDeltaX!==undefined)deltaX=-1*orgEvent.wheelDeltaX/120/wheelDeltaScaleFactor;args.unshift(event,delta,deltaX,deltaY);if($.event.handle)return $.event.handle.apply(this,args)}})(jQuery);
 
(function($){$.fn.fixedHeaderTable=function(method){var defaults={width:"100%",height:"100%",themeClass:"fht-default",borderCollapse:true,fixedColumns:0,fixedColumn:false,sortable:false,autoShow:true,footer:false,cloneHeadToFoot:false,autoResize:false,create:null};var settings={};var helpers={_formatInputNumberString:function(){settings.width=settings.width.toString();settings.height=settings.height.toString();settings.fixedColumns=parseInt(settings.fixedColumns,10)},_getMaxCountOfRow:function($obj){var count=
0;$obj.find("tr").each(function(){if(count<$(this).children().length)count=$(this).children().length});return count},_insertFixedLabel:function($obj,maxCount){var $self=$obj,leftRowspanValues,colspan,count;if(settings.fixedColumns&&settings.fixedColumns>0){$self.find("thead tr").each(function(){leftRowspanValues=0;$(this).children().each(function(){if(leftRowspanValues<settings.fixedColumns){$(this).addClass("fixed-column-cell");colspan=$(this).attr("colspan");leftRowspanValues+=colspan?parseInt(colspan,
10):1}})});$self.find("tfoot tr").each(function(){leftRowspanValues=0;$(this).children().each(function(){if(leftRowspanValues<settings.fixedColumns){$(this).addClass("fixed-column-cell");colspan=$(this).attr("colspan");leftRowspanValues+=colspan?parseInt(colspan,10):1}})});$self.find("tbody tr").each(function(){leftRowspanValues=settings.fixedColumns+$(this).children().length-maxCount;$(this).children().each(function(){if(leftRowspanValues>0){$(this).addClass("fixed-column-cell");colspan=$(this).attr("colspan");
leftRowspanValues-=colspan?parseInt(colspan,10):1}})})}},_isTable:function($obj){var $self=$obj,hasTable=$self.is("table"),hasThead=$self.find("thead").length>0,hasTbody=$self.find("tbody").length>0;if(hasTable&&hasThead&&hasTbody)return true;return false},_bindScroll:function($obj,tableProps){var $self=$obj,$wrapper=$self.closest(".fht-table-wrapper"),$thead=$self.siblings(".fht-thead"),$tfoot=$self.siblings(".fht-tfoot");$self.bind("scroll",function(){if(settings.fixedColumns>0){var $fixedColumns=
$wrapper.find(".fht-fixed-column");$fixedColumns.find(".fht-tbody table").css({"margin-top":-$self.scrollTop()})}$thead.find("table").css({"margin-left":-this.scrollLeft});if(settings.footer||settings.cloneHeadToFoot)$tfoot.find("table").css({"margin-left":-this.scrollLeft})})},_fixHeightWithCss:function($obj,tableProps){if(settings.includePadding)$obj.css({"height":$obj.height()+tableProps.border});else $obj.css({"height":$obj.parent().height()+tableProps.border})},_fixWidthWithCss:function($obj,
tableProps,width){if(settings.includePadding)$obj.each(function(index){$(this).css({"width":width===undefined?$(this).width()+tableProps.border:width+tableProps.border})});else $obj.each(function(index){$(this).css({"width":width===undefined?$(this).parent().width()+tableProps.border:width+tableProps.border})})},_setupFixedColumn:function($obj,obj,tableProps){var $self=$obj,self=obj,$wrapper=$self.closest(".fht-table-wrapper"),$fixedBody=$wrapper.find(".fht-fixed-body"),$fixedColumn=$wrapper.find(".fht-fixed-column"),
$thead=$('<div class="fht-thead"><table class="fht-table"><thead></thead></table></div>'),$tbody=$('<div class="fht-tbody"><table class="fht-table"><tbody></tbody></table></div>'),$tfoot=$('<div class="fht-tfoot"><table class="fht-table"><tfoot></tfoot></table></div>'),$firstThChildren=[],$firstTdChildren=[],fixedColumnWidth,fixedBodyWidth=$wrapper.width(),fixedBodyHeight=$fixedBody.find(".fht-tbody").height()-settings.scrollbarOffset,$newRow,tdWidths=[];$thead.find("table.fht-table").addClass(settings.originalTable.attr("class"));
$tbody.find("table.fht-table").addClass(settings.originalTable.attr("class"));$tfoot.find("table.fht-table").addClass(settings.originalTable.attr("class"));$fixedBody.find(".fht-thead thead tr").each(function(){$firstThChildren.push($(this).find("th:lt("+settings.fixedColumns/parseInt($(this).find("th:first-child").attr("colspan"),10)+")"))});fixedColumnWidth=settings.fixedColumns*tableProps.border;$.each($firstThChildren[$firstThChildren.length-1],function(index){fixedColumnWidth+=$(this).outerWidth(true)});
$.each($firstThChildren,function(){helpers._fixHeightWithCss($(this),tableProps);helpers._fixWidthWithCss($(this),tableProps)});$.each($firstThChildren[$firstThChildren.length-1],function(){tdWidths.push($(this).width())});$fixedBody.find("tbody tr").each(function(){var reverseArray=$(this).find(".fixed-column-cell").toArray().reverse();$.each(reverseArray,function(index){helpers._fixHeightWithCss($(this),tableProps);helpers._fixWidthWithCss($(this),tableProps,tdWidths[(settings.fixedColumns-index-
1)%settings.fixedColumns])});$firstTdChildren.push(reverseArray.reverse())});$.each($firstThChildren,function(){$thead.find("thead").append($("<tr></tr>").append($(this).clone()))});$thead.appendTo($fixedColumn);$.each($firstTdChildren,function(index){$tbody.find("tbody").append($("<tr></tr>").append($(this).clone()))});$tbody.appendTo($fixedColumn).css({"margin-top":-1,"height":fixedBodyHeight+tableProps.border});$fixedColumn.css({"height":0,"width":fixedColumnWidth});var maxTop=$fixedColumn.find(".fht-tbody .fht-table").height()-
$fixedColumn.find(".fht-tbody").height();$fixedColumn.find(".fht-tbody .fht-table").bind("mousewheel",function(event,delta,deltaX,deltaY){if(deltaY===0)return;var top=parseInt($(this).css("marginTop"),10)+(deltaY>0?120:-120);if(top>0)top=0;if(top<-maxTop)top=-maxTop;$(this).css("marginTop",top);$fixedBody.find(".fht-tbody").scrollTop(-top).scroll();return false});$fixedBody.css({"width":fixedBodyWidth});if(settings.footer===true){if(settings.cloneHeadToFoot===true)$.each($firstThChildren,function(){$tfoot.find("tfoot").append($("<tr></tr>").append($(this).clone()))});
else{var $firstTdFootChild=$fixedBody.find(".fht-tfoot tr > *:lt("+settings.fixedColumns+")");helpers._fixHeightWithCss($firstTdFootChild,tableProps);var $cell=$firstTdFootChild.find("div.fht-cell").length?$(this).find("div.fht-cell"):$('<div class="fht-cell"></div>').appendTo($firstTdFootChild);$tfoot.find("tfoot").append($("<tr></tr>").append($firstTdFootChild.clone()))}$tfoot.appendTo($fixedColumn);var footwidth=$tfoot.find("table").innerWidth();$tfoot.css({"top":settings.scrollbarOffset,"width":footwidth})}},
_setupTableFooter:function($obj,obj,tableProps){var $self=$obj,self=obj,$wrapper=$self.closest(".fht-table-wrapper"),$tfoot=$self.find("tfoot"),$divFoot=$wrapper.find("div.fht-tfoot");if(!$divFoot.length)if(settings.fixedColumns>0)$divFoot=$('<div class="fht-tfoot"><table class="fht-table"></table></div>').appendTo($wrapper.find(".fht-fixed-body"));else $divFoot=$('<div class="fht-tfoot"><table class="fht-table"></table></div>').appendTo($wrapper);$divFoot.find("table.fht-table").addClass(settings.originalTable.attr("class"));
if(!$tfoot.length&&settings.cloneHeadToFoot===true){var $divHead=$wrapper.find("div.fht-thead");$divFoot.empty();$divHead.find("table").clone().appendTo($divFoot)}else if($tfoot.length&&settings.cloneHeadToFoot===false){$divFoot.find("table").append($tfoot).css({"margin-top":-tableProps.border});helpers._setupClone($divFoot,tableProps.tfoot)}},_getTableProps:function($obj){var tableProp={thead:{},tbody:{},tfoot:{},border:0},borderCollapse=1;if(settings.borderCollapse===true)borderCollapse=2;tableProp.border=
($obj.find("th:first-child").outerWidth()-$obj.find("th:first-child").innerWidth())/borderCollapse;$obj.find("thead tr").each(function(trIndex){tableProp.thead[trIndex]=[];$(this).find("th").each(function(thIndex){tableProp.thead[trIndex][thIndex]=$(this).width()+tableProp.border})});$obj.find("tfoot tr").each(function(trIndex){tableProp.tfoot[trIndex]=[];if($(this).find("td").length)$(this).find("td").each(function(thIndex){tableProp.tfoot[trIndex][thIndex]=$(this).width()+tableProp.border});else if($(this).find("th").length)$(this).find("th").each(function(thIndex){tableProp.tfoot[trIndex][thIndex]=
$(this).width()+tableProp.border})});$obj.find("tbody tr").each(function(trIndex){tableProp.tbody[trIndex]=[];$(this).find("td").each(function(tdIndex){tableProp.tbody[trIndex][tdIndex]=$(this).width()+tableProp.border})});return tableProp},_setupClone:function($obj,cellArray){var $self=$obj,selector=($self.find("tbody").length?"tbody":$self.find("tfoot").length?"tfoot":"thead")+" tr",subselector=$self.find("tbody").length?"td":$self.find("thead").length?"th":"td";if("td"===subselector&&!$self.find("tfoot td").length)subselector=
"th";$self.find(selector).each(function(trIndex){$(this).find(subselector).each(function(tdIndex){var $cell=$(this).find("div.fht-cell").length?$(this).find("div.fht-cell"):$('<div class="fht-cell"></div>').appendTo($(this));$cell.css({"width":parseInt(cellArray[trIndex][tdIndex],10)});if(!$(this).closest(".fht-tbody").length&&$(this).is(":last-child")&&!$(this).closest(".fht-fixed-column").length&&(!$(this).parent().is(":last-child")||$(this).parent().is(":first-child"))){var padding=($(this).innerWidth()-
$(this).width())/2+settings.scrollbarOffset;$(this).css({"padding-right":padding+"px"})}})})},_isPaddingIncludedWithWidth:function(){var $obj=$('<table class="fht-table"><tr><td style="padding: 10px; font-size: 10px;">test</td></tr></table>'),defaultHeight,newHeight;$obj.addClass(settings.originalTable.attr("class"));$obj.appendTo("body");defaultHeight=$obj.find("td").height();$obj.find("td").css("height",$obj.find("tr").height());newHeight=$obj.find("td").height();$obj.remove();return defaultHeight!==
newHeight},_getScrollbarWidth:function(){var scrollbarWidth=0;if(!scrollbarWidth)if(/msie/.test(navigator.userAgent.toLowerCase())){var $textarea1=$('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1E3,left:-1E3}).appendTo("body"),$textarea2=$('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1E3,left:-1E3}).appendTo("body");scrollbarWidth=$textarea1.width()-$textarea2.width()+2;$textarea1.add($textarea2).remove()}else{var $div=
$("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1E3,left:-1E3}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200});scrollbarWidth=100-$div.width();$div.parent().remove()}return scrollbarWidth}};var methods={init:function(options){settings=$.extend({},defaults,options);return this.each(function(){var $self=$(this),self=this;if(helpers._isTable($self)){methods.setup.apply(this,Array.prototype.slice.call(arguments,1));if($.isFunction(settings.create))settings.create.call(this)}else $.error("Invalid table mark-up")})},
setup:function(options){var $self=$(this),self=this,$thead=$self.find("thead"),$tfoot=$self.find("tfoot"),$tbody=$self.find("tbody"),$wrapper,$divHead,$divFoot,$divBody,$fixedBody,$fixedHeadRow,$temp,tfootHeight=0,widthMinusScrollbar,maxCount;settings.originalTable=$(this).clone();settings.includePadding=helpers._isPaddingIncludedWithWidth();settings.scrollbarOffset=helpers._getScrollbarWidth();settings.themeClassName=settings.themeClass;helpers._formatInputNumberString();maxCount=helpers._getMaxCountOfRow($self);
helpers._insertFixedLabel($self,maxCount);if(settings.width.toString().search("%")>-1)widthMinusScrollbar=$self.parent().width()-settings.scrollbarOffset;else widthMinusScrollbar=settings.width-settings.scrollbarOffset;$self.css({width:widthMinusScrollbar});if(!$self.closest(".fht-table-wrapper").length){$self.addClass("fht-table");$self.wrap('<div class="fht-table-wrapper"></div>')}$wrapper=$self.closest(".fht-table-wrapper");if(settings.fixedColumn===true&&settings.fixedColumns<=0)settings.fixedColumns=
1;if(settings.fixedColumns>0&&$wrapper.find(".fht-fixed-column").length===0){$self.wrap('<div class="fht-fixed-body"></div>');var $fixedColumns=$('<div class="fht-fixed-column"></div>').prependTo($wrapper);$fixedBody=$wrapper.find(".fht-fixed-body")}$wrapper.css({width:settings.width,height:settings.height}).addClass(settings.themeClassName);if(!$self.hasClass("fht-table-init"))$self.wrap('<div class="fht-tbody"></div>');$divBody=$self.closest(".fht-tbody");var tableProps=helpers._getTableProps($self);
helpers._setupClone($divBody,tableProps.tbody);if(!$self.hasClass("fht-table-init")){if(settings.fixedColumns>0)$divHead=$('<div class="fht-thead"><table class="fht-table"></table></div>').prependTo($fixedBody);else $divHead=$('<div class="fht-thead"><table class="fht-table"></table></div>').prependTo($wrapper);$divHead.find("table.fht-table").addClass(settings.originalTable.attr("class"));$thead.clone().appendTo($divHead.find("table"))}else $divHead=$wrapper.find("div.fht-thead");helpers._setupClone($divHead,
tableProps.thead);$self.css("margin-top",-$divHead.outerHeight(true));if(settings.footer===true){helpers._setupTableFooter($self,self,tableProps);if(!$tfoot.length)$tfoot=$wrapper.find("div.fht-tfoot table");tfootHeight=$tfoot.outerHeight(true)}var tbodyHeight=$wrapper.height()-$thead.outerHeight(true)-tfootHeight-tableProps.border;$divBody.css("height",tbodyHeight);$self.addClass("fht-table-init");if(typeof settings.altClass)methods.altRows.apply(self);if(settings.fixedColumns>0)helpers._setupFixedColumn($self,
self,tableProps);if(!settings.autoShow)$wrapper.hide();helpers._bindScroll($divBody,tableProps);return self},resize:function(options){var $self=$(this),self=this;return self},altRows:function(arg1){var $self=$(this),self=this,altClass=typeof arg1?arg1:settings.altClass;$self.closest(".fht-table-wrapper").find("tbody tr:odd:not(:hidden)").addClass(altClass)},show:function(arg1,arg2,arg3){var $self=$(this),self=this,$wrapper=$self.closest(".fht-table-wrapper");if(typeof arg1&&typeof arg1==="number")$wrapper.show(arg1,
function(){if($.isFunction(arg2))arg2.call(this)});else if(typeof arg1&&typeof arg1==="string"&&typeof arg2&&typeof arg2==="number")$wrapper.show(arg1,arg2,function(){if($.isFunction(arg3))arg3.call(this)});else{$self.closest(".fht-table-wrapper").show();if($.isFunction(arg1))arg1.call(this)}return self},hide:function(arg1,arg2,arg3){var $self=$(this),self=this,$wrapper=$self.closest(".fht-table-wrapper");if(typeof arg1&&typeof arg1==="number")$wrapper.hide(arg1,function(){if($.isFunction(arg3))arg3.call(this)});
else if(typeof arg1&&typeof arg1==="string"&&typeof arg2&&typeof arg2==="number")$wrapper.hide(arg1,arg2,function(){if($.isFunction(arg3))arg3.call(this)});else{$self.closest(".fht-table-wrapper").hide();if($.isFunction(arg3))arg3.call(this)}return self},destroy:function(){var $self=$(this),self=this,$wrapper=$self.closest(".fht-table-wrapper");$self.insertBefore($wrapper).removeAttr("style").append($wrapper.find("tfoot")).removeClass("fht-table fht-table-init").find(".fht-cell").remove();$wrapper.remove();
return self}};if(methods[method])return methods[method].apply(this,Array.prototype.slice.call(arguments,1));if(typeof method!=="object"&&method)$.error('Method "'+method+'" does not exist in fixedHeaderTable plugin!');else return methods.init.apply(this,arguments)}})(jQuery);