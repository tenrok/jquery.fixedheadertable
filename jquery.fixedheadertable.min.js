/*! Copyright (c) 2010 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.4
 * 
 * Requires: 1.2.2+
 */

/*!
 * jquery.fixedHeaderTable. The jQuery fixedHeaderTable plugin
 *
 * Copyright (c) 2011 Mark Malek
 * http://fixedheadertable.com
 *
 * Licensed under MIT
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * http://docs.jquery.com/Plugins/Authoring
 * jQuery authoring guidelines
 *
 * Launch  : October 2009
 * Version : 1.3
 * Released: May 9th, 2011
 *
 * 
 * all CSS sizing (width,height) is done in pixels (px)
 */


(function(e){e.fn.fixedHeaderTable=function(t){var n={width:"100%",height:"100%",themeClass:"fht-default",borderCollapse:true,fixedColumns:0,fixedColumn:false,sortable:false,autoShow:true,footer:false,cloneHeadToFoot:false,autoResize:false,create:null};var r={};var i={_formatInputNumberString:function(){r.width=r.width.toString();r.height=r.height.toString();r.fixedColumns=parseInt(r.fixedColumns,10)},_getMaxCountOfRow:function(t){var n=0;t.find("tr").each(function(){if(n<e(this).children().length){n=e(this).children().length}});return n},_insertFixedLabel:function(t,n){var i=t,s,o,u;if(r.fixedColumns&&r.fixedColumns>0){i.find("thead tr").each(function(){s=0;e(this).children().each(function(){if(s<r.fixedColumns){e(this).addClass("fixed-column-cell");o=e(this).attr("colspan");s+=o?parseInt(o,10):1}})});i.find("tfoot tr").each(function(){s=0;e(this).children().each(function(){if(s<r.fixedColumns){e(this).addClass("fixed-column-cell");o=e(this).attr("colspan");s+=o?parseInt(o,10):1}})});i.find("tbody tr").each(function(){s=r.fixedColumns+e(this).children().length-n;e(this).children().each(function(){if(s>0){e(this).addClass("fixed-column-cell");o=e(this).attr("colspan");s-=o?parseInt(o,10):1}})})}},_isTable:function(e){var t=e,n=t.is("table"),r=t.find("thead").length>0,i=t.find("tbody").length>0;if(n&&r&&i){return true}return false},_bindScroll:function(e,t){var n=e,i=n.closest(".fht-table-wrapper"),s=n.siblings(".fht-thead"),o=n.siblings(".fht-tfoot");n.bind("scroll",function(){if(r.fixedColumns>0){var e=i.find(".fht-fixed-column");e.find(".fht-tbody table").css({"margin-top":-n.scrollTop()})}s.find("table").css({"margin-left":-this.scrollLeft});if(r.footer||r.cloneHeadToFoot){o.find("table").css({"margin-left":-this.scrollLeft})}})},_fixHeightWithCss:function(e,t){if(r.includePadding){e.css({height:e.height()+t.border})}else{e.css({height:e.parent().height()+t.border})}},_fixWidthWithCss:function(t,n,i){if(r.includePadding){t.each(function(t){e(this).css({width:i===undefined?e(this).width()+n.border:i+n.border})})}else{t.each(function(t){e(this).css({width:i===undefined?e(this).parent().width()+n.border:i+n.border})})}},_setupFixedColumn:function(t,n,s){var o=t,u=n,a=o.closest(".fht-table-wrapper"),f=a.find(".fht-fixed-body"),l=a.find(".fht-fixed-column"),c=e('<div class="fht-thead"><table class="fht-table"><thead></thead></table></div>'),h=e('<div class="fht-tbody"><table class="fht-table"><tbody></tbody></table></div>'),p=e('<div class="fht-tfoot"><table class="fht-table"><tfoot></tfoot></table></div>'),d=[],v=[],m,g=a.width(),y=f.find(".fht-tbody").height()-r.scrollbarOffset,b,w=[];c.find("table.fht-table").addClass(r.originalTable.attr("class"));h.find("table.fht-table").addClass(r.originalTable.attr("class"));p.find("table.fht-table").addClass(r.originalTable.attr("class"));f.find(".fht-thead thead tr").each(function(){d.push(e(this).find("th:lt("+r.fixedColumns/parseInt(e(this).find("th:first-child").attr("colspan"),10)+")"))});m=r.fixedColumns*s.border;e.each(d[d.length-1],function(t){m+=e(this).outerWidth(true)});e.each(d,function(){i._fixHeightWithCss(e(this),s);i._fixWidthWithCss(e(this),s)});e.each(d[d.length-1],function(){w.push(e(this).width())});f.find("tbody tr").each(function(){var t=e(this).find(".fixed-column-cell").toArray().reverse();e.each(t,function(t){i._fixHeightWithCss(e(this),s);i._fixWidthWithCss(e(this),s,w[(r.fixedColumns-t-1)%r.fixedColumns])});v.push(t.reverse())});e.each(d,function(){c.find("thead").append(e("<tr></tr>").append(e(this).clone()))});c.appendTo(l);e.each(v,function(t){h.find("tbody").append(e("<tr></tr>").append(e(this).clone()))});h.appendTo(l).css({"margin-top":-1,height:y+s.border});l.css({height:0,width:m});var E=l.find(".fht-tbody .fht-table").height()-l.find(".fht-tbody").height();l.find(".fht-table").bind("mousewheel",function(t,n,r,i){if(i===0){return}var s=parseInt(e(this).css("marginTop"),10)+(i>0?120:-120);if(s>0){s=0}if(s<-E){s=-E}e(this).css("marginTop",s);f.find(".fht-tbody").scrollTop(-s).scroll();return false});f.css({width:g});if(r.footer===true){if(r.cloneHeadToFoot===true){e.each(d,function(){p.find("tfoot").append(e("<tr></tr>").append(e(this).clone()))})}else{var S=f.find(".fht-tfoot tr > *:lt("+r.fixedColumns+")");i._fixHeightWithCss(S,s);var x=S.find("div.fht-cell").length?e(this).find("div.fht-cell"):e('<div class="fht-cell"></div>').appendTo(S);p.find("tfoot").append(e("<tr></tr>").append(S.clone()))}p.appendTo(l);var T=p.find("table").innerWidth();p.css({top:r.scrollbarOffset,width:T})}},_setupTableFooter:function(t,n,s){var o=t,u=n,a=o.closest(".fht-table-wrapper"),f=o.find("tfoot"),l=a.find("div.fht-tfoot");if(!l.length){if(r.fixedColumns>0){l=e('<div class="fht-tfoot"><table class="fht-table"></table></div>').appendTo(a.find(".fht-fixed-body"))}else{l=e('<div class="fht-tfoot"><table class="fht-table"></table></div>').appendTo(a)}}l.find("table.fht-table").addClass(r.originalTable.attr("class"));if(!f.length&&r.cloneHeadToFoot===true){var c=a.find("div.fht-thead");l.empty();c.find("table").clone().appendTo(l)}else if(f.length&&r.cloneHeadToFoot===false){l.find("table").append(f).css({"margin-top":-s.border});i._setupClone(l,s.tfoot)}},_getTableProps:function(t){var n={thead:{},tbody:{},tfoot:{},border:0},i=1;if(r.borderCollapse===true){i=2}n.border=(t.find("th:first-child").outerWidth()-t.find("th:first-child").innerWidth())/i;t.find("thead tr").each(function(t){n.thead[t]=[];e(this).find("th").each(function(r){n.thead[t][r]=e(this).width()+n.border})});t.find("tfoot tr").each(function(t){n.tfoot[t]=[];if(e(this).find("td").length){e(this).find("td").each(function(r){n.tfoot[t][r]=e(this).width()+n.border})}else if(e(this).find("th").length){e(this).find("th").each(function(r){n.tfoot[t][r]=e(this).width()+n.border})}});t.find("tbody tr").each(function(t){n.tbody[t]=[];e(this).find("td").each(function(r){n.tbody[t][r]=e(this).width()+n.border})});return n},_setupClone:function(t,n){var i=t,s=(i.find("tbody").length?"tbody":i.find("tfoot").length?"tfoot":"thead")+" tr",o=i.find("tbody").length?"td":i.find("thead").length?"th":"td";if("td"===o&&!i.find("tfoot td").length){o="th"}i.find(s).each(function(t){e(this).find(o).each(function(i){var s=e(this).find("div.fht-cell").length?e(this).find("div.fht-cell"):e('<div class="fht-cell"></div>').appendTo(e(this));s.css({width:parseInt(n[t][i],10)});if(!e(this).closest(".fht-tbody").length&&e(this).is(":last-child")&&!e(this).closest(".fht-fixed-column").length&&(!e(this).parent().is(":last-child")||e(this).parent().is(":first-child"))){var o=(e(this).innerWidth()-e(this).width())/2+r.scrollbarOffset;e(this).css({"padding-right":o+"px"})}})})},_isPaddingIncludedWithWidth:function(){var t=e('<table class="fht-table"><tr><td style="padding: 10px; font-size: 10px;">test</td></tr></table>'),n,i;t.addClass(r.originalTable.attr("class"));t.appendTo("body");n=t.find("td").height();t.find("td").css("height",t.find("tr").height());i=t.find("td").height();t.remove();return n!==i},_getScrollbarWidth:function(){var t=0;if(!t){if(/msie/.test(navigator.userAgent.toLowerCase())){var n=e('<textarea cols="10" rows="2"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body"),r=e('<textarea cols="10" rows="2" style="overflow: hidden;"></textarea>').css({position:"absolute",top:-1e3,left:-1e3}).appendTo("body");t=n.width()-r.width()+2;n.add(r).remove()}else{var i=e("<div />").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1e3,left:-1e3}).prependTo("body").append("<div />").find("div").css({width:"100%",height:200});t=100-i.width();i.parent().remove()}}return t}};var s={init:function(t){r=e.extend({},n,t);return this.each(function(){var t=e(this),n=this;if(i._isTable(t)){s.setup.apply(this,Array.prototype.slice.call(arguments,1));if(e.isFunction(r.create)){r.create.call(this)}}else{e.error("Invalid table mark-up")}})},setup:function(t){var n=e(this),o=this,u=n.find("thead"),a=n.find("tfoot"),f=n.find("tbody"),l,c,h,p,d,v,m,g=0,y,b;r.originalTable=e(this).clone();r.includePadding=i._isPaddingIncludedWithWidth();r.scrollbarOffset=i._getScrollbarWidth();r.themeClassName=r.themeClass;i._formatInputNumberString();b=i._getMaxCountOfRow(n);i._insertFixedLabel(n,b);if(r.width.toString().search("%")>-1){y=n.parent().width()-r.scrollbarOffset}else{y=r.width-r.scrollbarOffset}n.css({width:y});if(!n.closest(".fht-table-wrapper").length){n.addClass("fht-table");n.wrap('<div class="fht-table-wrapper"></div>')}l=n.closest(".fht-table-wrapper");if(r.fixedColumn===true&&r.fixedColumns<=0){r.fixedColumns=1}if(r.fixedColumns>0&&l.find(".fht-fixed-column").length===0){n.wrap('<div class="fht-fixed-body"></div>');var w=e('<div class="fht-fixed-column"></div>').prependTo(l);d=l.find(".fht-fixed-body")}l.css({width:r.width,height:r.height}).addClass(r.themeClassName);if(!n.hasClass("fht-table-init")){n.wrap('<div class="fht-tbody"></div>')}p=n.closest(".fht-tbody");var E=i._getTableProps(n);i._setupClone(p,E.tbody);if(!n.hasClass("fht-table-init")){if(r.fixedColumns>0){c=e('<div class="fht-thead"><table class="fht-table"></table></div>').prependTo(d)}else{c=e('<div class="fht-thead"><table class="fht-table"></table></div>').prependTo(l)}c.find("table.fht-table").addClass(r.originalTable.attr("class"));u.clone().appendTo(c.find("table"))}else{c=l.find("div.fht-thead")}i._setupClone(c,E.thead);n.css("margin-top",-c.outerHeight(true));if(r.footer===true){i._setupTableFooter(n,o,E);if(!a.length){a=l.find("div.fht-tfoot table")}g=a.outerHeight(true)}var S=l.height()-u.outerHeight(true)-g-E.border;p.css("height",S);n.addClass("fht-table-init");if(typeof r.altClass){s.altRows.apply(o)}if(r.fixedColumns>0){i._setupFixedColumn(n,o,E)}if(!r.autoShow){l.hide()}i._bindScroll(p,E);return o},resize:function(t){var n=e(this),r=this;return r},altRows:function(t){var n=e(this),i=this,s=typeof t?t:r.altClass;n.closest(".fht-table-wrapper").find("tbody tr:odd:not(:hidden)").addClass(s)},show:function(t,n,r){var i=e(this),s=this,o=i.closest(".fht-table-wrapper");if(typeof t&&typeof t==="number"){o.show(t,function(){if(e.isFunction(n)){n.call(this)}})}else if(typeof t&&typeof t==="string"&&typeof n&&typeof n==="number"){o.show(t,n,function(){if(e.isFunction(r)){r.call(this)}})}else{i.closest(".fht-table-wrapper").show();if(e.isFunction(t)){t.call(this)}}return s},hide:function(t,n,r){var i=e(this),s=this,o=i.closest(".fht-table-wrapper");if(typeof t&&typeof t==="number"){o.hide(t,function(){if(e.isFunction(r)){r.call(this)}})}else if(typeof t&&typeof t==="string"&&typeof n&&typeof n==="number"){o.hide(t,n,function(){if(e.isFunction(r)){r.call(this)}})}else{i.closest(".fht-table-wrapper").hide();if(e.isFunction(r)){r.call(this)}}return s},destroy:function(){var t=e(this),n=this,r=t.closest(".fht-table-wrapper");t.insertBefore(r).removeAttr("style").append(r.find("tfoot")).removeClass("fht-table fht-table-init").find(".fht-cell").remove();r.remove();return n}};if(s[t]){return s[t].apply(this,Array.prototype.slice.call(arguments,1))}if(typeof t!=="object"&&t){e.error('Method "'+t+'" does not exist in fixedHeaderTable plugin!')}else{return s.init.apply(this,arguments)}}})(jQuery)